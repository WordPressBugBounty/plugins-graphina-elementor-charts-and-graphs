{"version":3,"file":"data_table.js","sources":["../assets/elementor/js/apex-chart/DataTable.js"],"sourcesContent":["// Class specifically for Data table\nexport default class DataTable {\n    constructor() {\n        this.tableHandlers = {};\n        this.tableId = '';\n        this.dataTable = {}\n        this.init();\n        this.observer = {}; // For IntersectionObserver\n    }\n\n    // Initialize the class by setting up handlers and events\n    init() {\n        this.setUpTableHandler();\n        this.bindEventHandlers();\n    }\n\n    // Bind event listeners\n    bindEventHandlers() {\n        jQuery(window).on('elementor/frontend/init', this.handleElementorWidgetInit.bind(this));\n        jQuery(window).on('load', () => {\n        jQuery('.graphina-jquery-data-table').each((i, el) => {\n            this.initializeTables(jQuery(el));\n        });\n        });\n        jQuery(document.body).off('click','.graphina-filter-div-button')\n        jQuery(document.body).on('click','.graphina-filter-div-button', this.debounce(this.handleChartFilterTable.bind(this), 300));\n \n    }\n\n    debounce(func, wait) {\n        let timeout;\n    \n        return function(...args) {\n            const context = this;\n            clearTimeout(timeout);\n            timeout = setTimeout(() => func.apply(context, args), wait);\n        };\n    }\n\n    handleChartFilterTable(e){\n            const currentElement = e.currentTarget\n            const elementId      = jQuery(currentElement).data('element_id');\n            const chartElement   = jQuery(`.graphina-jquery-data-table[data-element_id=\"${elementId}\"]`);\n            if(chartElement.length > 0){\n                this.setupTable(chartElement,[])\n            }    \n    }\n\n    handleElementorWidgetInit() {\n        elementorFrontend.hooks.addAction('frontend/element_ready/data_table_lite.default', ($scope) => {\n            console.log('Initializing jQuery Data Table...');\n            \n            const chartElement = $scope.find('.graphina-jquery-data-table');\n            if (chartElement.length > 0) {\n                this.initializeTables(chartElement);\n            }\n        });\n    }\n\n\n    initializeTables(chartElement) {\n        const chartType = chartElement.data('chart_type');\n        if (this.tableHandlers[chartType]) {\n            this.tableHandlers[chartType](chartElement);\n        }\n    }\n\n\n\n    setUpTableHandler() {\n        this.tableHandlers = {\n            data_table_lite: (element) => this.observeTableElement(element, 'data_table_lite'),\n        };\n    }\n\n    // Setup IntersectionObserver to call setupTable when the element is in the viewport\n    observeTableElement(element, dataTableType) {\n        const elementID = element.data('element_id')\n        if (gcfe_public_localize.view_port === 'off') {\n            if (!this.observer[elementID]) {\n                this.observer[elementID] = new IntersectionObserver((entries) => {\n                    entries.forEach((entry) => {\n                        if (entry.isIntersecting) {\n                            // Element is in viewport; initialize the chart\n                            this.setupTable(jQuery(entry.target), dataTableType);\n                            // Stop observing the element after initializing the chart\n                            this.observer[elementID].unobserve(entry.target);\n                        }\n                    });\n                }, { threshold: 0.1 }); // Trigger when at least 10% of the element is visible\n            }\n            this.observer[elementID].observe(element[0]); // Start observing the chart element\n        } else {\n            this.setupTable(element, dataTableType);\n        }\n    }\n\n    getDynamicData(settings, extraData, elementId,filterValue) {\n        let post_id = jQuery(`[data-element_id=\"${elementId}\"]`).closest('[data-elementor-id]').data('elementor-id');\n        return new Promise((resolve, reject) => {\n            jQuery.ajax({\n                url: gcfe_public_localize.ajaxurl,\n                type: 'POST',\n                dataType: 'json',\n                data: {\n                    action      : 'get_jquery_datatable_data',\n                    nonce       : gcfe_public_localize.table_nonce,\n                    chartType   : 'data_table_lite',\n                    post_id     : post_id,\n                    element_id  : elementId,\n                    series_count: 0,\n                    settings    : JSON.stringify(settings),\n                    selected_field: filterValue,\n                },\n                success: (response) => {\n                    jQuery('#data_table_lite_loading_' + elementId).hide();\n                    jQuery('#data_table_lite_no_data_' + elementId).hide();\n                    resolve(response);\n                },\n                error: (error) => {\n                    jQuery('#data_table_lite_loading_' + elementId).hide();\n                    jQuery('#data_table_lite_no_data_' + elementId).hide();\n                    console.error('AJAX Error:', error);\n                    reject(new Error('AJAX request failed.'));\n                },\n            });\n        });\n    }\n\n    sanitizeTableOptions(options) {\n        const sanitize = (obj) => {\n            if (typeof obj === 'string') {\n                return obj.replace(/<[^>]*>/g, '').replace(/javascript:/gi, '');\n            } else if (Array.isArray(obj)) {\n                return obj.map(sanitize);\n            } else if (typeof obj === 'object' && obj !== null) {\n                const sanitized = {};\n                for (const key in obj) sanitized[key] = sanitize(obj[key]);\n                return sanitized;\n            }\n            return obj;\n        };\n        return sanitize(options);\n    }\n\n    async setupTable(element, dataTableType) {\n        const element_id = element.data('element_id');\n        this.tableId     = element_id;\n\n        let chart_data      = this.sanitizeTableOptions(element.data('chart_data'));\n        const extraData     = this.sanitizeTableOptions(element.data('extra_data'));\n        const settings      = this.sanitizeTableOptions(element.data('settings'));\n        const tableSelector = '.data_table_lite_' + element_id;\n    \n        if ( extraData.hide_column_header ) {\n            chart_data.headerCallback = function(thead, data, start, end, display) {\n                jQuery(thead).hide();\n            }\n        }\n        chart_data.fnInitComplete = () => {\n            jQuery('.dataTables_scrollBody').css({\n                'overflow': 'hidden',\n                'border': '0'\n            });\n            jQuery(`#data_table_lite_${element_id} thead th`).addClass('all graphina-datatable-columns');\n            jQuery(`#data_table_lite_${element_id} tbody td`).addClass('graphina-datatable-tbody-td');\n    \n            const tableScrollFoot = jQuery('.dataTables_scrollFoot');\n            tableScrollFoot.css('overflow', 'auto');\n            tableScrollFoot.on('scroll', function () {\n                jQuery('.dataTables_scrollBody').scrollLeft(jQuery(this).scrollLeft());\n            });\n        };\n    \n        chart_data.rowCallback = function (row, data, index) {\n            if (index % 2 === 0) {\n                jQuery(row).addClass('odd');\n            } else {\n                jQuery(row).addClass('even');\n            }\n        };\n    \n        // Destroy existing DataTable and clear table HTML.\n        if (this.dataTable[element_id]) {\n            this.dataTable[element_id].clear().destroy();\n            jQuery(tableSelector).empty();\n        }\n    \n        // Handle dynamic data fetching if applicable.\n        if (extraData.is_dynamic_table) {\n            let filterValue   = [];\n            const totalFilter = jQuery(`#graphina_chart_filter_${element_id}`).data('total_filter');\n    \n            for (let index = 0; index < totalFilter; index++) {\n                filterValue[index] =\n                    jQuery(`#graphina-start-date_${index}${element_id}`).val() ??\n                    jQuery(`#graphina-drop_down_filter_${index}${element_id}`).val();\n            }\n    \n            const dynamicData = await this.getDynamicData(settings, extraData, element_id, filterValue);\n    \n            if (dynamicData.data.body.length !== 0 && dynamicData.data.header.length !== 0) {\n                chart_data.data = dynamicData.data.body;\n                chart_data.columns = dynamicData.data.header;\n                jQuery('#data_table_lite_loading_' + element_id).hide();\n            } else {\n                jQuery('#data_table_lite_loading_' + element_id).show();\n            }\n        } else {\n            if (chart_data.columns.length > 0) {\n                jQuery('#data_table_lite_loading_' + element_id).hide();\n            }\n        }\n    \n        // Add thead before reinitializing\n        if (chart_data.columns && chart_data.columns.length > 0) {\n            const theadHTML = '<thead><tr>' +\n                chart_data.columns.map(col => `<th>${col.title}</th>`).join('') +\n                '</tr></thead>';\n            jQuery(tableSelector).append(theadHTML);\n        }\n\n        // Initialize DataTable\n        this.dataTable[element_id] = jQuery(tableSelector).DataTable(chart_data);\n    \n        // Add tfoot if required\n        if (extraData.table_footer) {\n            jQuery(`#data_table_lite_${element_id}`).append('<tfoot><tr>' +\n                chart_data.columns.map(column => `<th class=\"${extraData.header_class}\">${column.title}</th>`).join('') +\n                '</tr></tfoot>');\n        }\n    \n        // Re-init if direct data table override is enabled\n        if (extraData.table_data_direct) {\n            this.dataTable[element_id].destroy();\n            jQuery(tableSelector).empty();\n    \n            const theadHTML = '<thead><tr>' +\n                chart_data.columns.map(col => `<th>${col.title}</th>`).join('') +\n                '</tr></thead>';\n            jQuery(tableSelector).append(theadHTML);\n    \n            this.dataTable[element_id] = jQuery(tableSelector).DataTable(chart_data);\n        }    \n    }\n    \n\n}\n// Initialize Data Table\nwindow.graphinaDataTable = new DataTable();\n"],"names":["DataTable","i","el","func","wait","timeout","args","context","e","currentElement","elementId","chartElement","$scope","chartType","element","dataTableType","elementID","entries","entry","settings","extraData","filterValue","post_id","resolve","reject","response","error","options","sanitize","obj","sanitized","key","element_id","chart_data","tableSelector","thead","data","start","end","display","tableScrollFoot","row","index","totalFilter","dynamicData","theadHTML","col","column"],"mappings":"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"}