class h{constructor(){this.tableHandlers={},this.tableId="",this.dataTable={},this.init(),this.observer={}}init(){this.setUpTableHandler(),this.bindEventHandlers()}bindEventHandlers(){jQuery(window).on("elementor/frontend/init",this.handleElementorWidgetInit.bind(this)),jQuery(window).on("load",()=>{jQuery(".graphina-jquery-data-table").each((a,i)=>{this.initializeTables(jQuery(i))})}),jQuery(document.body).off("click",".graphina-filter-div-button"),jQuery(document.body).on("click",".graphina-filter-div-button",this.debounce(this.handleChartFilterTable.bind(this),300))}debounce(a,i){let t;return function(...e){const r=this;clearTimeout(t),t=setTimeout(()=>a.apply(r,e),i)}}handleChartFilterTable(a){const i=a.currentTarget,t=jQuery(i).data("element_id"),e=jQuery(`.graphina-jquery-data-table[data-element_id="${t}"]`);e.length>0&&this.setupTable(e,[])}handleElementorWidgetInit(){elementorFrontend.hooks.addAction("frontend/element_ready/data_table_lite.default",a=>{console.log("Initializing jQuery Data Table...");const i=a.find(".graphina-jquery-data-table");i.length>0&&this.initializeTables(i)})}initializeTables(a){const i=a.data("chart_type");this.tableHandlers[i]&&this.tableHandlers[i](a)}setUpTableHandler(){this.tableHandlers={data_table_lite:a=>this.observeTableElement(a,"data_table_lite")}}observeTableElement(a,i){const t=a.data("element_id");gcfe_public_localize.view_port==="off"?(this.observer[t]||(this.observer[t]=new IntersectionObserver(e=>{e.forEach(r=>{r.isIntersecting&&(this.setupTable(jQuery(r.target),i),this.observer[t].unobserve(r.target))})},{threshold:.1})),this.observer[t].observe(a[0])):this.setupTable(a,i)}getDynamicData(a,i,t,e){let r=jQuery(`[data-element_id="${t}"]`).closest("[data-elementor-id]").data("elementor-id");return new Promise((c,n)=>{jQuery.ajax({url:gcfe_public_localize.ajaxurl,type:"POST",dataType:"json",data:{action:"get_jquery_datatable_data",nonce:gcfe_public_localize.table_nonce,chartType:"data_table_lite",post_id:r,element_id:t,series_count:0,settings:JSON.stringify(a),selected_field:e},success:l=>{jQuery("#data_table_lite_loading_"+t).hide(),jQuery("#data_table_lite_no_data_"+t).hide(),c(l)},error:l=>{jQuery("#data_table_lite_loading_"+t).hide(),jQuery("#data_table_lite_no_data_"+t).hide(),console.error("AJAX Error:",l),n(new Error("AJAX request failed."))}})})}sanitizeTableOptions(a){const i=t=>{if(typeof t=="string")return t.replace(/<[^>]*>/g,"").replace(/javascript:/gi,"");if(Array.isArray(t))return t.map(i);if(typeof t=="object"&&t!==null){const e={};for(const r in t)e[r]=i(t[r]);return e}return t};return i(a)}async setupTable(a,i){const t=a.data("element_id");this.tableId=t;let e=this.sanitizeTableOptions(a.data("chart_data"));const r=this.sanitizeTableOptions(a.data("extra_data")),c=this.sanitizeTableOptions(a.data("settings")),n=".data_table_lite_"+t;if(r.hide_column_header&&(e.headerCallback=function(l,s,d,o,u){jQuery(l).hide()}),e.fnInitComplete=()=>{jQuery(".dataTables_scrollBody").css({overflow:"hidden",border:"0"}),jQuery(`#data_table_lite_${t} thead th`).addClass("all graphina-datatable-columns"),jQuery(`#data_table_lite_${t} tbody td`).addClass("graphina-datatable-tbody-td");const l=jQuery(".dataTables_scrollFoot");l.css("overflow","auto"),l.on("scroll",function(){jQuery(".dataTables_scrollBody").scrollLeft(jQuery(this).scrollLeft())})},e.rowCallback=function(l,s,d){d%2===0?jQuery(l).addClass("odd"):jQuery(l).addClass("even")},this.dataTable[t]&&(this.dataTable[t].clear().destroy(),jQuery(n).empty()),r.is_dynamic_table){let l=[];const s=jQuery(`#graphina_chart_filter_${t}`).data("total_filter");for(let o=0;o<s;o++)l[o]=jQuery(`#graphina-start-date_${o}${t}`).val()??jQuery(`#graphina-drop_down_filter_${o}${t}`).val();const d=await this.getDynamicData(c,r,t,l);d.data.body.length!==0&&d.data.header.length!==0?(e.data=d.data.body,e.columns=d.data.header,jQuery("#data_table_lite_loading_"+t).hide()):jQuery("#data_table_lite_loading_"+t).show()}else e.columns.length>0&&jQuery("#data_table_lite_loading_"+t).hide();if(e.columns&&e.columns.length>0){const l="<thead><tr>"+e.columns.map(s=>`<th>${s.title}</th>`).join("")+"</tr></thead>";jQuery(n).append(l)}if(this.dataTable[t]=jQuery(n).DataTable(e),r.table_footer&&jQuery(`#data_table_lite_${t}`).append("<tfoot><tr>"+e.columns.map(l=>`<th class="${r.header_class}">${l.title}</th>`).join("")+"</tr></tfoot>"),r.table_data_direct){this.dataTable[t].destroy(),jQuery(n).empty();const l="<thead><tr>"+e.columns.map(s=>`<th>${s.title}</th>`).join("")+"</tr></thead>";jQuery(n).append(l),this.dataTable[t]=jQuery(n).DataTable(e)}}}window.graphinaDataTable=new h;
//# sourceMappingURL=data_table.js.map
