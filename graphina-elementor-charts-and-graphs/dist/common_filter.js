class A{constructor(){this.chartHandlers={},this.mainChart={},this.isGoogleChartsLoaded=!1,this.init()}init(){this.bindEventHandlers()}bindEventHandlers(){jQuery(document).off("click",".graphina-filter-div-button.common"),jQuery(document).on("click",".graphina-filter-div-button.common",t=>{this.debounce(this.handleCommonChartUpdate.bind(this),300)(t)})}debounce(t,e){let r;return function(...i){const a=this;clearTimeout(r),r=setTimeout(()=>t.apply(a,i),e)}}handleCommonChartUpdate(t){t.preventDefault();const e=t.currentTarget,r=e.textContent;e.dataset.originalText=r;const i=gcfe_public_localize.loading_btn;e.textContent=i,e.classList.add("loading_btn");const a=jQuery(e).data("element_id"),d=jQuery(`#graphina_chart_filter_${a}`).data("total_filter");let c=[];for(let o=0;o<d;o++)c[o]=jQuery(`#graphina-start-date_${o}${a}`).val()??jQuery(`#graphina-drop_down_filter_${o}${a}`).val();const h=jQuery(".common-filter-chart"),s=jQuery(".common-filter-google-chart");h.length>0&&(jQuery(document).find(".graphina-loader").show(),h.each((o,_)=>{const n=jQuery(_),l=n.data("element_id"),u=n.data("chart_type");this.mainChart[l]?this.mainChart[l].destroy():ApexCharts.exec(l,"destroy"),console.log(l),jQuery(document).find(`.graphina-${l}-loader`).show(),this.updateChartWithCommonFilter(n,u,c)})),s.length>0&&(jQuery(document).find(".graphina-loader").show(),s.each((o,_)=>{const n=jQuery(_),l=n.data("element_id"),u=n.data("chart_type_static");jQuery(document).find(`.graphina-${l}-loader`).show(),this.UpdateGoogleChartWithCommonFilter(n,u,c)}))}getDynamicData(t,e,r,i,a){let d="graphina_get_dynamic_data",c=gcfe_public_localize.nonce;r==="counter"&&(d="get_jquery_datatable_data",c=gcfe_public_localize.table_nonce);let h=jQuery(`[data-element_id="${i}"]`).closest("[data-elementor-id]").data("elementor-id"),s=h;return e.is_same_acf_field_id&&(s=e.custom_post_id_for_acf_field),new Promise((o,_)=>{jQuery.ajax({url:gcfe_public_localize.ajaxurl,type:"POST",dataType:"json",data:{action:d,nonce:c,chartType:r,post_id:h,field_post_id:s,element_id:i,series_count:e.chart_data_series_count_dynamic,settings:JSON.stringify(t),selected_field:a},success:n=>{n.status&&jQuery("body").hasClass("elementor-editor-active")&&(r==="counter"&&this.setFieldsForCounter(t,n,r,e),(e.chart_csv_column_wise_enable||e.chart_dynamic_data_option==="sql-builder")&&(e.chart_dynamic_data_option==="csv"||e.chart_dynamic_data_option==="remote-csv"||e.chart_dynamic_data_option==="google-sheet"||e.chart_dynamic_data_option==="sql-builder")&&this.setFieldsForCSV(t,n,r,e),e.dynamic_type==="forminator"&&this.setFieldForForminator(n,r,e)),jQuery(".graphina-filter-div-button.common").removeClass("loading_btn").prop("disabled",!1).each(function(){const l=jQuery(this).data("original-text");l?jQuery(this).text(l):jQuery(this).text(gcfe_public_localize.i18n.apply_filter||"Apply Filter")}),o(n)},error:n=>{console.error("AJAX Error:",n),_(new Error("AJAX request failed."))}})})}getChartOptions(t,e,r,i,a){return t}setupTableData(t,e,r,i,a){var d,c,h,s;if(!t||!e){console.warn("Required parameters are missing");return}try{((c=(d=t.google_chart_data)==null?void 0:d.title_array)==null?void 0:c.length)>0&&((s=(h=t.google_chart_data)==null?void 0:h.data)==null?void 0:s.length)>0?(typeof t.google_chart_data.title=="string"&&e.addColumn("string",t.google_chart_data.title),t.google_chart_data.title_array.forEach(o=>{o&&(e.addColumn("number",String(o)),t.google_chart_data.annotation_show===!0&&e.addColumn({type:"string",role:"annotation"}))}),Array.isArray(t.google_chart_data.data)&&t.google_chart_data.data.forEach(o=>{Array.isArray(o)&&e.addRow(o)}),r&&i&&(r.show(),i.hide())):Array.isArray(t.columns)&&Array.isArray(t.rows)&&t.columns.length>0&&t.rows.length>0?(t.columns.forEach(o=>{o&&e.addColumn(o)}),t.rows.forEach(o=>{Array.isArray(o)&&e.addRow(o)})):r&&i&&(r.hide(),i.show())}catch(o){console.error("Error setting up table data:",o),r&&i&&(r.hide(),i.show())}}getFinalChartOptions(t){return t}async updateChartWithCommonFilter(t,e,r){var h,s,o;const i=t.data("element_id"),a=t.data("chart_options"),d=t.data("extra_data"),c=t.data("settings");if(!a||!i||!e){console.error("Missing required chart options or element ID."),jQuery(document).find(`.graphina-${i}-loader`).hide();return}try{let _=Array.isArray(r)?r:[r];const n=await this.getDynamicData(c,d,e,i,_),l=((h=n==null?void 0:n.extra)==null?void 0:h.series)??[],u=((s=n==null?void 0:n.extra)==null?void 0:s.category)??[];if(!Array.isArray(l)||l.length===0||Array.isArray((o=l[0])==null?void 0:o.data)&&l[0].data.length===0){a.series=[],a.xaxis.categories=[],t.hide(),jQuery(`.graphina-${i}-notext`).show(),jQuery(`.graphina-${i}-loader`).hide();return}else jQuery(`.graphina-${i}-notext`).hide();e==="nested_column"?a.series=[{data:l}]:e==="column"?(a.chart.type="bar",a.series=l,a.xaxis.categories=u):["polar","radialBar","radial","pie","donut"].includes(e)?(a.series=l,a.labels=u):(a.series=l,a.xaxis.categories=u),t.show(),e==="column"||e==="distributed_column"?a.chart.type="bar":e==="polar"&&(a.chart.type="polarArea");const y=this.getChartOptions(a,e,d,t.data("responsive_options"),i);t.empty();const j=new ApexCharts(t[0],y);try{await j.render()}catch(p){console.error("Error rendering chart:",p)}jQuery(".graphina-filter-div-button.common").removeClass("loading_btn").prop("disabled",!1).each(function(){const p=jQuery(this).data("original-text");p?jQuery(this).text(p):jQuery(this).text(gcfe_public_localize.i18n.apply_filter||"Apply Filter")}),jQuery(document).find(`.graphina-${i}-loader`).hide()}catch(_){console.error("Error updating chart with common filter:",_),jQuery(document).find(`.graphina-${i}-loader`).hide()}}async UpdateGoogleChartWithCommonFilter(t,e,r){var c,h;const i=t.closest(".chart-box"),a=i?i.find(".google-chart-texture"):null,d=i?i.find(".graphina-google-chart"):null;try{const s=t.data("element_id"),o=t.data("chart_type"),_=t.data("chart_data"),n=t.data("extra_data"),l=t.data("settings"),u=t.data("chart_options")||{},f=jQuery(`.graphina-${s}-notext`);if(await this.loadGoogleCharts(),!google.visualization[e])throw new Error(`Invalid chart type: ${e}`);const y=new google.visualization.DataTable;if(n.chart_data_option){try{let g=Array.isArray(r)?r:[r];const C=jQuery(`#graphina_chart_filter_${s}`).data("total_filter");for(let w=0;w<C;w++){let Q=jQuery(`#graphina-start-date_${w}${s}`).val()??jQuery(`#graphina-drop_down_filter_${w}${s}`).val();g[w]=typeof Q=="string"?Q.trim():Q}const m=await this.getDynamicData(l,n,o,s,g);if(Array.isArray((c=m.google_chart_data)==null?void 0:c.data)&&m.google_chart_data.data.length>0||Array.isArray(m.rows)&&m.rows.length>0)f.hide();else{d.hide(),a.hide(),f.show(),jQuery(`.graphina-${s}-loader`).hide();return}this.setupTableData(m,y,d,a,n)}catch(g){d.hide(),a.show(),f.show(),console.error("Failed to get dynamic data:",g)}jQuery(document).find(`.graphina-${s}-loader`).hide()}else{const g=this.getFinalChartData(_);if(Array.isArray((h=g.google_chart_data)==null?void 0:h.data)&&g.google_chart_data.data.length>0||Array.isArray(g.rows)&&g.rows.length>0)f.hide();else{d.hide(),a.hide(),f.show(),jQuery(`.graphina-${s}-loader`).hide();return}this.setupTableData(g,y,d,a,n)}e==="Gantt"&&this.setDependField(l,n);const j=new google.visualization[e](t[0]),p=this.getFinalChartOptions(u,s);j.draw(y,p)}catch(s){d.hide(),a.show(),jQuery(`.graphina-${elementId}-notext`).show(),console.error(`Error initializing ${e} chart:`,s)}}async loadGoogleCharts(){if(!this.isGoogleChartsLoaded)return new Promise((t,e)=>{try{google.charts.load("current",{packages:["corechart","geochart","gauge","gantt","orgchart"]}),google.charts.setOnLoadCallback(()=>{this.isGoogleChartsLoaded=!0,t()})}catch(r){console.error("Error loading Google Charts:",r),e(r)}})}}jQuery(()=>{window.GraphinaFilterBase=new A});
//# sourceMappingURL=common_filter.js.map
