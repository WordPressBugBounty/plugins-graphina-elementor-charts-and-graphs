class C{constructor(){this.chartHandlers={},this.isGoogleChartsLoaded=!1,this.init()}init(){this.setUpChartsHandler(),this.bindEventHandlers()}bindEventHandlers(){jQuery(document.body).off("change",".graphina-select-google-chart-type").on("change",".graphina-select-google-chart-type",this.debounce(this.handleChartTypeChange.bind(this),300)),jQuery(window).on("elementor/frontend/init",this.handleElementorWidgetInit.bind(this)),jQuery(window).on("elementor/editor/init",this.handleElementorWidgetInit.bind(this)),jQuery(document.body).off("click",".graphina-filter-div-button.google"),jQuery(document.body).on("click",".graphina-filter-div-button.google",this.handleChartFilter.bind(this))}debounce(e,t){let a;return function(...r){const n=this;clearTimeout(a),a=setTimeout(()=>e.apply(n,r),t)}}handleChartTypeChange(e){const t=jQuery(e.target),a=t.val(),r=t.data("element_id"),n=jQuery(`.graphina-google-chart[data-element_id="${r}"]`);n.length>0&&this.updateChartType(n,a)}updateChartType(e,t){this.setupChart(e,t)}handleChartFilter(e){const t=e.currentTarget,a=jQuery(t).data("element_id"),r=jQuery(`.graphina-google-chart[data-element_id="${a}"]`);let n=jQuery(r).data("chart_type");n="AreaChart",r.length>0&&this.setupChart(r,n)}setUpChartsHandler(){throw new Error("setUpChartsHandler method must be implemented by subclasses")}handleElementorWidgetInit(){elementorFrontend.hooks.addAction("frontend/element_ready/widget",e=>{const t=e.find(".graphina-google-chart");t.length>0&&this.initializeCharts(t)})}setupTableData(){throw new Error("setupTableData method must be implemented by subclasses")}initializeCharts(e){const t=e.data("chart_type");this.chartHandlers[t]&&this.chartHandlers[t](e)}setFieldsForCSV(e,t,a,r){const n=e[`${r.graphina_prefix}${a}_chart_dynamic_data_option`]==="sql-builder",i=`[data-setting="${r.graphina_prefix}${a}_${n?"chart_sql_builder_x_columns":"chart_csv_x_columns"}"]`,u=`[data-setting="${r.graphina_prefix}${a}_${n?"chart_sql_builder_y_columns":"chart_csv_y_columns"}"]`,o=parent.document.querySelector(i),l=parent.document.querySelector(u);if(!o||!l)return;o.innerHTML="",l.innerHTML="";const p=n?t.extra.db_column:t.extra.column,g=n?r.chart_csv_x_columns_sql:r.chart_csv_x_columns,h=n?r.chart_csv_y_columns_sql:r.chart_csv_y_columns;p.forEach(s=>{const y=Array.from(o.options).some(c=>c.value===s),d=Array.from(l.options).some(c=>c.value===s);if(!y){const c=Array.isArray(g)?g.includes(s):g===s;o.append(new Option(s,s,c,c))}if(!d){const c=Array.isArray(h)?h.includes(s):h===s;l.append(new Option(s,s,c,c))}})}getDynamicData(e,t,a,r,n){return new Promise((i,u)=>{jQuery.ajax({url:gcfe_public_localize.ajaxurl,type:"POST",dataType:"json",data:{action:"graphina_get_dynamic_data",nonce:gcfe_public_localize.nonce,chartType:a,post_id:t.current_post_id,element_id:r,series_count:t.chart_data_series_count_dynamic,settings:e,selected_field:n},success:o=>{o.status?((t.chart_csv_column_wise_enable||t.chart_dynamic_data_option==="sql-builder")&&(t.chart_dynamic_data_option==="csv"||t.chart_dynamic_data_option==="remote-csv"||t.chart_dynamic_data_option==="google-sheet"||t.chart_dynamic_data_option==="sql-builder")&&jQuery("body").hasClass("elementor-editor-active")&&this.setFieldsForCSV(e,o,a,t),i(o)):(console.error("Error:",o.message),u(new Error(o.message||"Failed to fetch dynamic data.")))},error:o=>{console.error("AJAX Error:",o),u(new Error("AJAX request failed."))}})})}getFinalChartOptions(e){return e}getFinalChartData(e){return e}prepareGanttRowData(e){return e.map(function(t,a){if(a===3||a===4)if(/^\d{2}-\d{2}-\d{4}$/.test(t)){let[r,n,i]=t.split("-");t=new Date(`${i}-${n}-${r}`)}else/^\d{4}-\d{2}-\d{2}$/.test(t)?t=new Date(t):t=null;return a===5&&(t=null),a===7&&(t==="null"||t==="0")?t=null:a===7&&t!=="null"&&(t=t.toString()),a===0&&(t=t.toString()),a===6&&(t=parseInt(t)),t})}afterSetupChart(e,t){return!0}async setupChart(e,t){const a=e.closest(".chart-box"),r=a?a.find(".google-chart-texture"):null,n=a?a.find(".graphina-google-chart"):null;try{const i=e.data("element_id"),u=e.data("chart_type"),o=e.data("chart_data"),l=e.data("extra_data"),p=e.data("settings"),g=e.data("chart_options")||{};if(await this.loadGoogleCharts(),!google.visualization[t])throw new Error(`Invalid chart type: ${t}`);const h=new google.visualization.DataTable;if(l.chart_data_option){try{let d=[];const c=jQuery(`#graphina_chart_filter_${i}`).data("total_filter");for(let _=0;_<c;_++)d[_]=jQuery(`#graphina-start-date_${_}${i}`).val()??jQuery(`#graphina-drop_down_filter_${_}${i}`).val();const m=await this.getDynamicData(p,l,u,i,d);this.setupTableData(m,h,n,r,l)}catch(d){n.hide(),r.show(),console.error("Failed to get dynamic data:",d)}jQuery(document).find(`.graphina-${i}-loader`).hide()}else{const d=this.getFinalChartData(o);this.setupTableData(d,h,n,r,l)}t==="Gantt"&&this.setDependField(p,l);const s=new google.visualization[t](e[0]),y=this.getFinalChartOptions(g);s.draw(h,y),this.afterSetupChart(e[0],l)}catch(i){n.hide(),r.show(),console.error(`Error initializing ${t} chart:`,i)}}async loadGoogleCharts(){if(!this.isGoogleChartsLoaded)return new Promise((e,t)=>{try{google.charts.load("current",{packages:["corechart","geochart","gauge","gantt","orgchart"]}),google.charts.setOnLoadCallback(()=>{this.isGoogleChartsLoaded=!0,e()})}catch(a){console.error("Error loading Google Charts:",a),t(a)}})}}export{C as G};
//# sourceMappingURL=GraphinaGoogleChartBase-BJhuS1mN.js.map
