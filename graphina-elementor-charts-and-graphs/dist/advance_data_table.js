class x{constructor(){this.extraData={},this.init(),this.currentPage=1,this.rowsPerPage=10,this.pageRange=2,this.observer={}}init(){this.bindEventHandlers()}bindEventHandlers(){jQuery(window).on("elementor/frontend/init",this.handleElementorWidgetInit.bind(this)),jQuery(window).on("load",()=>{jQuery(".graphina-advance-data-table").each((e,t)=>{this.initializeTables(jQuery(t))})})}handleElementorWidgetInit(){elementorFrontend.hooks.addAction("frontend/element_ready/advance-datatable.default",e=>{const t=e.find(".graphina-advance-data-table");t.length>0&&this.initializeTables(t)})}initializeTables(e){this.observeTableElement(e,"advance-datatable")}observeTableElement(e,t){const a=e.data("element_id");gcfe_public_localize.view_port==="off"?(this.observer[a]||(this.observer[a]=new IntersectionObserver(n=>{n.forEach(s=>{s.isIntersecting&&(this.setupTable(jQuery(s.target),t),this.observer[a].unobserve(s.target))})},{threshold:.1})),this.observer[a].observe(e[0])):this.setupTable(e,t)}getJson(e){let t=[],a=[],n=document.querySelector(e+" table"),s=n.getElementsByTagName("th");s.length>0&&Object.keys(s).forEach((o,i)=>{let l=s[i].getElementsByTagName("input")[0].value;t.push(l)});let r=n.getElementsByTagName("tr");return r.length>0&&Object.keys(r).forEach((o,i)=>{let l=[],p=r[i].getElementsByTagName("td");p.length>0&&(Object.keys(p).forEach((E,u)=>{let b=p[u].getElementsByTagName("input")[0].value;l.push(b)}),a.push(l))}),JSON.stringify({header:t,body:a})}generateTable(e,t,a=!1){var b,v;const n=document.querySelector(`.graphina-table-${t}`);n&&(n.innerHTML="");const s=jQuery("body").hasClass("elementor-editor-active"),r=document.createElement("table");r.classList.add("graphina-table-base","table-bordered","table-padding-left",`datatable-${t}`);let c=this.extraData[t].columns||e.header.length,o=this.extraData[t].rows||e.body.length;this.extraData[t].header_in_body&&o++,this.extraData[t].is_index&&!s&&!this.extraData[t].is_dynamic_table&&c++,a&&(o=e.body.length);const i=(this.currentPage-1)*this.rowsPerPage,l=i+this.rowsPerPage;let p=[];this.extraData[t].is_pagination&&(this.extraData[t].is_dynamic_table||!s)?(p=e.body.slice(i,l),o=p.length):p=e.body;const f=document.createElement("thead");f.classList.add("graphina-table-header");const E=document.createElement("tr");if(this.extraData[t].is_header&&e.header.length>0){for(let h=0;h<c;h++){const d=document.createElement("th");if(d.classList.add("graphina-table-cell"),s&&!this.extraData[t].is_dynamic_table){const g=document.createElement("input");g.type="text",g.setAttribute("placeholder",`Header ${h+1}`),g.value=e.header[h]||`Column ${h+1}`,d.append(g)}else d.innerHTML=e.header[h]||`Column ${h+1}`;E.appendChild(d)}f.appendChild(E),r.appendChild(f)}const u=document.createElement("tbody");if(u.classList.add("graphina-table-body"),o!==0&&e.header.length>0)for(let h=0;h<o;h++){const d=document.createElement("tr");for(let g=0;g<c;g++){const m=document.createElement("td");if(m.classList.add("graphina-table-cell"),s&&!this.extraData[t].is_dynamic_table){const y=document.createElement("input");y.type="text",y.setAttribute("placeholder",`Value ${g+1}`),y.value=((b=p[h])==null?void 0:b[g])||"",m.append(y)}else m.innerHTML=((v=p[h])==null?void 0:v[g])||"";d.appendChild(m)}u.appendChild(d)}else{const h=document.createElement("tr"),d=document.createElement("td");d.setAttribute("colspan",e.header.length),d.classList.add("graphina-table-no-data"),d.classList.add("graphina-table-cell"),d.innerText=gcfe_public_localize.no_data_available,h.appendChild(d),u.appendChild(h)}r.appendChild(u),n.append(r),this.extraData[t].is_pagination&&(this.extraData[t].is_dynamic_table||!s)&&(this.extraData[t].pagination_type==="numbers"?this.generatePaginationControlsNumber(e,t):this.extraData[t].pagination_type==="simple"?this.generatePaginationControlsSimple(e,t):this.extraData[t].pagination_type==="simple_numbers"?this.generatePaginationControlsSimpleNumbers(e,t):this.generatePaginationControlsFistLast(e,t))}createButton(e,t,a=!1){const n=document.createElement("span");return n.classList.add("pagination-link","graphina-align"),a?n.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" width="${e}" height="${e}" fill="${t}"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"/></svg>`:n.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" width="${e}" height="${e}" fill="${t}"><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>`,n}createPaginationInfo(e,t,a){if(this.extraData[a].pagination_info){const n=document.createElement("div");n.classList.add("pagination-info");const s=(this.currentPage-1)*this.rowsPerPage+1,r=Math.min(t,this.currentPage*this.rowsPerPage);n.innerText=`Showing ${s} to ${r} of ${t} entries`,e.append(n),this.paginationStyle(e,n[a],a)}}generatePaginationControlsFistLast(e,t){const a=document.querySelector(`.graphina-table-${t}`);let n=Math.ceil(e.body.length/this.rowsPerPage);const s=document.createElement("section");s.classList.add("pagination-section");const r=document.createElement("div");r.classList.add("graphina-pagination");let c=e.body.length;if(this.createPaginationInfo(r,c,t),n>1){const o=document.createElement("div");if(o.classList.add("page-links-wrapper"),o.style.display="flex",this.currentPage>1){const i=this.createButton(this.extraData[t].pagination_button_height,this.extraData[t].pagination_text_color,!0);i.addEventListener("click",()=>{this.currentPage--,this.generateTable(e,t)}),o.appendChild(i)}for(let i=1;i<=n;i++)if(i===1||n===i){const l=document.createElement("button");l.textContent=i,l.classList.add("pagination-link"),i===this.currentPage&&l.classList.add("active"),l.addEventListener("click",()=>{this.currentPage=i,this.generateTable(e,t)}),o.appendChild(l)}if(this.currentPage<n){const i=this.createButton(this.extraData[t].pagination_button_height,this.extraData[t].pagination_text_color,!1);i.addEventListener("click",()=>{this.currentPage++,this.generateTable(e,t)}),o.appendChild(i)}r.appendChild(o)}s.appendChild(r),a.appendChild(s)}generatePaginationControlsSimpleNumbers(e,t){const a=document.querySelector(`.graphina-table-${t}`);let n=Math.ceil(e.body.length/this.rowsPerPage),s=e.body.length;const r=document.createElement("section");r.classList.add("pagination-section");const c=document.createElement("div");if(c.classList.add("graphina-pagination"),this.createPaginationInfo(c,s,t),n>1){const o=document.createElement("div");if(o.classList.add("page-links-wrapper"),o.style.display="flex",this.currentPage>1){const i=this.createButton(this.extraData[t].pagination_button_height,this.extraData[t].pagination_text_color,!0);i.addEventListener("click",()=>{this.currentPage--,this.generateTable(e,t)}),o.appendChild(i)}for(let i=Math.max(1,this.currentPage-this.pageRange);i<=Math.min(n,this.currentPage+this.pageRange);i++){const l=document.createElement("button");l.textContent=i,l.classList.add("pagination-link"),i===this.currentPage&&l.classList.add("active"),l.addEventListener("click",()=>{this.currentPage=i,this.generateTable(e,t)}),o.appendChild(l)}if(this.currentPage<n){const i=this.createButton(this.extraData[t].pagination_button_height,this.extraData[t].pagination_text_color,!1);i.addEventListener("click",()=>{this.currentPage++,this.generateTable(e,t)}),o.appendChild(i)}c.appendChild(o)}r.appendChild(c),a.appendChild(r)}paginationStyle(e,t,a){var s;const n=((s=this.extraData[a])==null?void 0:s.pagination_align)??"";n==="right"?e.classList.add("rightLeft"):n==="left"?e.classList.add("leftRight"):n==="center"&&(e.classList.add("centerPagination"),this.extraData[a].pagination_info==="yes"&&(t.style.margin="20px 0"))}generatePaginationControlsSimple(e,t){const a=document.querySelector(`.graphina-table-${t}`);let n=Math.ceil(e.body.length/this.rowsPerPage);const s=document.createElement("section");s.classList.add("pagination-section");const r=document.createElement("div");r.classList.add("graphina-pagination");let c=e.body.length;if(this.createPaginationInfo(r,c,t),n>1){const o=document.createElement("div");o.classList.add("page-links-wrapper"),o.style.display="flex";const i=this.createButton(this.extraData[t].pagination_button_height,this.extraData[t].pagination_text_color,!0);i.disabled=this.currentPage===1,i.addEventListener("click",()=>{this.currentPage>1&&(this.currentPage--,this.generateTable(e,t))}),o.appendChild(i);const l=this.createButton(this.extraData[t].pagination_button_height,this.extraData[t].pagination_text_color,!1);l.disabled=this.currentPage===n,l.addEventListener("click",()=>{this.currentPage<n&&(this.currentPage++,this.generateTable(e,t))}),o.appendChild(l),r.appendChild(o)}s.appendChild(r),a.appendChild(s)}generatePaginationControlsNumber(e,t){const a=document.querySelector(`.graphina-table-${t}`);let n=Math.ceil(e.body.length/this.rowsPerPage);const s=document.createElement("section");s.classList.add("pagination-section");const r=document.createElement("div");r.classList.add("graphina-pagination");let c=e.body.length;if(this.createPaginationInfo(r,c,t),n>1){const o=document.createElement("div");o.classList.add("page-links-wrapper"),o.style.display="flex";for(let i=Math.max(1,this.currentPage-this.pageRange);i<=Math.min(n,this.currentPage+this.pageRange);i++){const l=document.createElement("button");l.textContent=i,l.classList.add("pagination-link"),i===this.currentPage&&l.classList.add("active"),l.addEventListener("click",()=>{this.currentPage=i,this.generateTable(e,t)}),o.appendChild(l)}r.appendChild(o),s.appendChild(r),a.appendChild(s)}}getDynamicData(e,t){let a=jQuery(`[data-element_id="${e}"]`).closest("[data-elementor-id]").data("elementor-id");return new Promise((n,s)=>{jQuery.ajax({url:gcfe_public_localize.ajaxurl,type:"POST",dataType:"json",data:{action:"get_jquery_datatable_data",nonce:gcfe_public_localize.table_nonce,chartType:"advance-datatable",post_id:a,element_id:e,series_count:0,settings:JSON.stringify(t),selected_field:[]},success:r=>{n(r)},error:r=>{console.error("AJAX Error:",r),s(new Error("AJAX request failed."))}})})}sanitizeTableOptions(e){const t=a=>{if(typeof a=="string")return a.replace(/<[^>]*>/g,"").replace(/javascript:/gi,"");if(Array.isArray(a))return a.map(t);if(typeof a=="object"&&a!==null){const n={};for(const s in a)n[s]=t(a[s]);return n}return a};return t(e)}async setupTable(e,t){const a=e.data("element_id");this.extraData[a]=e.data("extra_data");const n=this.sanitizeTableOptions(e.data("table_data")),s=this.sanitizeTableOptions(e.data("settings"));if(this.rowsPerPage=this.extraData[a].pagination_row,this.pageRange=this.extraData[a].page_range,this.extraData[a].is_dynamic_table){const r=await this.getDynamicData(a,s);this.generateTable(r.data,a),this.setupSearchFilter(a,r.data)}else this.generateTable(n,a);this.extraData[a].is_dynamic_table||(document.querySelector(`.graphina-table-${a} table`)&&document.querySelector(`.graphina-table-${a} table`).addEventListener("change",()=>{let r=this.getJson(`.graphina-table-${a}`),c=parent.document.querySelector(`input[data-setting="${this.extraData[a].prefix}advance-datatable_element_data_json"]`);if(document.querySelector(`input[data-setting="${this.extraData[a].prefix}advance-datatable_element_data_json"]`),c){c.value=r;let o=new Event("input",{bubbles:!0});c.dispatchEvent(o)}else console.warn("Hidden input field not found!")}),this.setupSearchFilter(a,n))}setupSearchFilter(e,t){const a=document.getElementById(`table-filter-${e}`);a&&a.addEventListener("keyup",()=>{const n=a.value.toLowerCase(),s=t.body;let r={header:t.header,body:[]};r.body=s.filter(function(c){return c.filter(function(o){return o.toString().toLowerCase().includes(n)}).length>0}),this.generateTable(r,e,!0)})}}window.graphinaDataTable=new x;
//# sourceMappingURL=advance_data_table.js.map
